language: shell
before_install:
 - sudo add-apt-repository ppa:rmescandon/yq -y
 - sudo apt update
 - sudo apt install yq -y
script:
  - ./ci/package.sh ${PUBLISH_DIR} ${TRAVIS_BRANCH}
  - cp build/.travis.yml ${PUBLISH_DIR}
  - cp -R ./ci ${PUBLISH_DIR}
env:
  global:
    - PUBLISH_BRANCH=publish
    - PUBLISH_DIR=publish
branches:
  - master
  - dev
deploy:
  - provider: script
    script: ./ci/publish.sh ${PUBLISH_BRANCH} ${PUBLISH_DIR}
    on:
      all_branches: true